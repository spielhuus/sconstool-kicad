#!/usr/bin/env python
#
# Permission is hereby granted, free of charge, to any person obtaining
# a copy of this software and associated documentation files (the
# "Software"), to deal in the Software without restriction, including
# without limitation the rights to use, copy, modify, merge, publish,
# distribute, sublicense, and/or sell copies of the Software, and to
# permit persons to whom the Software is furnished to do so, subject to
# the following conditions:
#
# The above copyright notice and this permission notice shall be included
# in all copies or substantial portions of the Software.
#
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY
# KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
# WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
# NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
# LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
# OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
# WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
#

import unittest

from sys import path as syspath
from os import path as ospath
from pathlib import Path
import json

syspath.append("..")

comnbined_result = {"kontur": {'summary': {'drc': 0, 'unconnected': 0, 'erc': 0}, "main": {"bom": [{"ref": ["C1", "C2"], "value": "22u", "datasheet": "~", "description": "Aluminium Electrolytic Capacitors (50V, D=6.3 mm, LS=2.5 mm)", "footprint": "Capacitor_THT:CP_Radial_D6.3mm_P2.50mm"}, {"ref": ["C3", "C4", "C5", "C6", "C8", "C10", "C11"], "value": "0.1u", "datasheet": "~", "description": "Multilayer Ceramic Capacitors MLCC (50V, L=4 mm, W=2.5 mm, LS=2.5 mm)", "footprint": "Capacitor_THT:C_Rect_L4.0mm_W2.5mm_P2.50mm"}, {"ref": ["C7", "C9"], "value": "2.2u", "datasheet": "~", "description": "Multilayer Ceramic Capacitors MLCC (25V, L=6 mm, W=5.5 mm, LS=5 mm)", "footprint": "Capacitor_THT:C_Disc_D6.0mm_W4.4mm_P5.00mm"}, {"ref": ["D1", "D4", "D7", "D8", "D9", "D10", "D11", "D12", "D15", "D18", "D19", "D20", "D21", "D22"], "value": "1N4148", "datasheet": "https://assets.nexperia.com/documents/data-sheet/1N4148_1N4448.pdf", "description": "Diode_THT:D_DO-35_SOD27_P7.62mm_Horizontal", "footprint": "Diode_THT:D_DO-35_SOD27_P7.62mm_Horizontal"}, {"ref": ["D2", "D3", "D5", "D6", "D13", "D14", "D16", "D17"], "value": "1N4148", "datasheet": "https://assets.nexperia.com/documents/data-sheet/1N4148_1N4448.pdf", "description": "Diode_THT:D_DO-35_SOD27_P2.54mm_Vertical_KathodeUp", "footprint": "Diode_THT:D_DO-35_SOD27_P2.54mm_Vertical_KathodeUp"}, {"ref": ["J1"], "value": "01x09 Female", "datasheet": "~", "description": "Board to Board Connectors (2.54 mm)", "footprint": "Connector_PinSocket_2.54mm:PinSocket_1x09_P2.54mm_Vertical"}, {"ref": ["J2"], "value": "10 Pos", "datasheet": "~", "description": "Pin Header IDC (2.54mm)", "footprint": "Connector_IDC:IDC-Header_2x05_P2.54mm_Vertical"}, {"ref": ["J3"], "value": "01x07 Female", "datasheet": "~", "description": "Board to Board Connectors (2.54 mm)", "footprint": "Connector_PinSocket_2.54mm:PinSocket_1x07_P2.54mm_Vertical"}, {"ref": ["R1", "R16", "R19", "R32"], "value": "100k", "datasheet": "~", "description": "Metal Film Resistors - Through Hole (L=3.6 mm, D=1.6 mm, 1%)", "footprint": "Resistor_THT:R_Axial_DIN0204_L3.6mm_D1.6mm_P5.08mm_Horizontal"}, {"ref": ["R2", "R20"], "value": "27k", "datasheet": "~", "description": "Resistor_THT:R_Axial_DIN0204_L3.6mm_D1.6mm_P5.08mm_Horizontal", "footprint": "Resistor_THT:R_Axial_DIN0204_L3.6mm_D1.6mm_P5.08mm_Horizontal"}, {"ref": ["R3", "R21"], "value": "390k", "datasheet": "~", "description": "Metal Film Resistors - Through Hole (L=3.6 mm, D=1.6 mm, 1%)", "footprint": "Resistor_THT:R_Axial_DIN0204_L3.6mm_D1.6mm_P5.08mm_Horizontal"}, {"ref": ["R4", "R9", "R22", "R25"], "value": "47k", "datasheet": "~", "description": "Metal Film Resistors - Through Hole (L=3.6 mm, D=1.6 mm, 1%)", "footprint": "Resistor_THT:R_Axial_DIN0204_L3.6mm_D1.6mm_P5.08mm_Horizontal"}, {"ref": ["R5", "R6"], "value": "10", "datasheet": "~", "description": "Metal Film Resistors - Through Hole (L=3.6 mm, D=1.6 mm, 1%)", "footprint": "Resistor_THT:R_Axial_DIN0204_L3.6mm_D1.6mm_P5.08mm_Horizontal"}, {"ref": ["R7", "R23"], "value": "470k", "datasheet": "~", "description": "Metal Film Resistors - Through Hole (L=3.6 mm, D=1.6 mm, 1%)", "footprint": "Resistor_THT:R_Axial_DIN0204_L3.6mm_D1.6mm_P5.08mm_Horizontal"}, {"ref": ["R8", "R24"], "value": "2.2k", "datasheet": "~", "description": "Metal Film Resistors - Through Hole (L=3.6 mm, D=1.6 mm, 1%)", "footprint": "Resistor_THT:R_Axial_DIN0204_L3.6mm_D1.6mm_P5.08mm_Horizontal"}, {"ref": ["R10", "R26"], "value": "10k", "datasheet": "~", "description": "Metal Film Resistors - Through Hole (L=3.6 mm, D=1.6 mm, 1%)", "footprint": "Resistor_THT:R_Axial_DIN0204_L3.6mm_D1.6mm_P5.08mm_Horizontal"}, {"ref": ["R11", "R27"], "value": "36k", "datasheet": "~", "description": "Metal Film Resistors - Through Hole (L=3.6 mm, D=1.6 mm, 1%)", "footprint": "Resistor_THT:R_Axial_DIN0204_L3.6mm_D1.6mm_P5.08mm_Horizontal"}, {"ref": ["R12", "R14", "R15", "R17", "R18", "R28"], "value": "1k", "datasheet": "~", "description": "Metal Film Resistors - Through Hole (L=3.6 mm, D=1.6 mm, 1%)", "footprint": "Resistor_THT:R_Axial_DIN0204_L3.6mm_D1.6mm_P5.08mm_Horizontal"}, {"ref": ["R13", "R29"], "value": "220", "datasheet": "~", "description": "Metal Film Resistors - Through Hole (L=3.6 mm, D=1.6 mm, 1%)", "footprint": "Resistor_THT:R_Axial_DIN0204_L3.6mm_D1.6mm_P5.08mm_Horizontal"}, {"ref": ["U1", "U2", "U4"], "value": "LM324", "datasheet": "http://www.ti.com/lit/ds/symlink/lm2902-n.pdf", "description": "Package_DIP:DIP-14_W7.62mm_Socket", "footprint": "Package_DIP:DIP-14_W7.62mm_Socket"}, {"ref": ["U3"], "value": "4001", "datasheet": "http://www.intersil.com/content/dam/Intersil/documents/cd40/cd4000bms-01bms-02bms-25bms.pdf", "description": "Package_DIP:DIP-14_W7.62mm_Socket", "footprint": "Package_DIP:DIP-14_W7.62mm_Socket"}], "drc": [], "unconnected": [], "erc": []}}}
comnbined_result_test = {'kontur': {'summary': {'drc': 0, 'unconnected': 0, 'erc': 0, 'unit_test': {'passed': 7, 'num_tests': 8}}, 'main': {'bom': [{'ref': ['C1', 'C2'], 'value': '22u', 'datasheet': '~', 'description': 'Aluminium Electrolytic Capacitors (50V, D=6.3 mm, LS=2.5 mm)', 'footprint': 'Capacitor_THT:CP_Radial_D6.3mm_P2.50mm'}, {'ref': ['C3', 'C4', 'C5', 'C6', 'C8', 'C10', 'C11'], 'value': '0.1u', 'datasheet': '~', 'description': 'Multilayer Ceramic Capacitors MLCC (50V, L=4 mm, W=2.5 mm, LS=2.5 mm)', 'footprint': 'Capacitor_THT:C_Rect_L4.0mm_W2.5mm_P2.50mm'}, {'ref': ['C7', 'C9'], 'value': '2.2u', 'datasheet': '~', 'description': 'Multilayer Ceramic Capacitors MLCC (25V, L=6 mm, W=5.5 mm, LS=5 mm)', 'footprint': 'Capacitor_THT:C_Disc_D6.0mm_W4.4mm_P5.00mm'}, {'ref': ['D1', 'D4', 'D7', 'D8', 'D9', 'D10', 'D11', 'D12', 'D15', 'D18', 'D19', 'D20', 'D21', 'D22'], 'value': '1N4148', 'datasheet': 'https://assets.nexperia.com/documents/data-sheet/1N4148_1N4448.pdf', 'description': 'Diode_THT:D_DO-35_SOD27_P7.62mm_Horizontal', 'footprint': 'Diode_THT:D_DO-35_SOD27_P7.62mm_Horizontal'}, {'ref': ['D2', 'D3', 'D5', 'D6', 'D13', 'D14', 'D16', 'D17'], 'value': '1N4148', 'datasheet': 'https://assets.nexperia.com/documents/data-sheet/1N4148_1N4448.pdf', 'description': 'Diode_THT:D_DO-35_SOD27_P2.54mm_Vertical_KathodeUp', 'footprint': 'Diode_THT:D_DO-35_SOD27_P2.54mm_Vertical_KathodeUp'}, {'ref': ['J1'], 'value': '01x09 Female', 'datasheet': '~', 'description': 'Board to Board Connectors (2.54 mm)', 'footprint': 'Connector_PinSocket_2.54mm:PinSocket_1x09_P2.54mm_Vertical'}, {'ref': ['J2'], 'value': '10 Pos', 'datasheet': '~', 'description': 'Pin Header IDC (2.54mm)', 'footprint': 'Connector_IDC:IDC-Header_2x05_P2.54mm_Vertical'}, {'ref': ['J3'], 'value': '01x07 Female', 'datasheet': '~', 'description': 'Board to Board Connectors (2.54 mm)', 'footprint': 'Connector_PinSocket_2.54mm:PinSocket_1x07_P2.54mm_Vertical'}, {'ref': ['R1', 'R16', 'R19', 'R32'], 'value': '100k', 'datasheet': '~', 'description': 'Metal Film Resistors - Through Hole (L=3.6 mm, D=1.6 mm, 1%)', 'footprint': 'Resistor_THT:R_Axial_DIN0204_L3.6mm_D1.6mm_P5.08mm_Horizontal'}, {'ref': ['R2', 'R20'], 'value': '27k', 'datasheet': '~', 'description': 'Resistor_THT:R_Axial_DIN0204_L3.6mm_D1.6mm_P5.08mm_Horizontal', 'footprint': 'Resistor_THT:R_Axial_DIN0204_L3.6mm_D1.6mm_P5.08mm_Horizontal'}, {'ref': ['R3', 'R21'], 'value': '390k', 'datasheet': '~', 'description': 'Metal Film Resistors - Through Hole (L=3.6 mm, D=1.6 mm, 1%)', 'footprint': 'Resistor_THT:R_Axial_DIN0204_L3.6mm_D1.6mm_P5.08mm_Horizontal'}, {'ref': ['R4', 'R9', 'R22', 'R25'], 'value': '47k', 'datasheet': '~', 'description': 'Metal Film Resistors - Through Hole (L=3.6 mm, D=1.6 mm, 1%)', 'footprint': 'Resistor_THT:R_Axial_DIN0204_L3.6mm_D1.6mm_P5.08mm_Horizontal'}, {'ref': ['R5', 'R6'], 'value': '10', 'datasheet': '~', 'description': 'Metal Film Resistors - Through Hole (L=3.6 mm, D=1.6 mm, 1%)', 'footprint': 'Resistor_THT:R_Axial_DIN0204_L3.6mm_D1.6mm_P5.08mm_Horizontal'}, {'ref': ['R7', 'R23'], 'value': '470k', 'datasheet': '~', 'description': 'Metal Film Resistors - Through Hole (L=3.6 mm, D=1.6 mm, 1%)', 'footprint': 'Resistor_THT:R_Axial_DIN0204_L3.6mm_D1.6mm_P5.08mm_Horizontal'}, {'ref': ['R8', 'R24'], 'value': '2.2k', 'datasheet': '~', 'description': 'Metal Film Resistors - Through Hole (L=3.6 mm, D=1.6 mm, 1%)', 'footprint': 'Resistor_THT:R_Axial_DIN0204_L3.6mm_D1.6mm_P5.08mm_Horizontal'}, {'ref': ['R10', 'R26'], 'value': '10k', 'datasheet': '~', 'description': 'Metal Film Resistors - Through Hole (L=3.6 mm, D=1.6 mm, 1%)', 'footprint': 'Resistor_THT:R_Axial_DIN0204_L3.6mm_D1.6mm_P5.08mm_Horizontal'}, {'ref': ['R11', 'R27'], 'value': '36k', 'datasheet': '~', 'description': 'Metal Film Resistors - Through Hole (L=3.6 mm, D=1.6 mm, 1%)', 'footprint': 'Resistor_THT:R_Axial_DIN0204_L3.6mm_D1.6mm_P5.08mm_Horizontal'}, {'ref': ['R12', 'R14', 'R15', 'R17', 'R18', 'R28'], 'value': '1k', 'datasheet': '~', 'description': 'Metal Film Resistors - Through Hole (L=3.6 mm, D=1.6 mm, 1%)', 'footprint': 'Resistor_THT:R_Axial_DIN0204_L3.6mm_D1.6mm_P5.08mm_Horizontal'}, {'ref': ['R13', 'R29'], 'value': '220', 'datasheet': '~', 'description': 'Metal Film Resistors - Through Hole (L=3.6 mm, D=1.6 mm, 1%)', 'footprint': 'Resistor_THT:R_Axial_DIN0204_L3.6mm_D1.6mm_P5.08mm_Horizontal'}, {'ref': ['U1', 'U2', 'U4'], 'value': 'LM324', 'datasheet': 'http://www.ti.com/lit/ds/symlink/lm2902-n.pdf', 'description': 'Package_DIP:DIP-14_W7.62mm_Socket', 'footprint': 'Package_DIP:DIP-14_W7.62mm_Socket'}, {'ref': ['U3'], 'value': '4001', 'datasheet': 'http://www.intersil.com/content/dam/Intersil/documents/cd40/cd4000bms-01bms-02bms-25bms.pdf', 'description': 'Package_DIP:DIP-14_W7.62mm_Socket', 'footprint': 'Package_DIP:DIP-14_W7.62mm_Socket'}], 'drc': [], 'unconnected': [], 'erc': []}, 'unit_test': {'report': {'environment': {'Python': '3.9.2', 'Platform': 'Linux-5.14.7-2-MANJARO-x86_64-with-glibc2.31'}, 'tests': [{'name': 'test/test_produkt.py::test_buffer_1a_voltage', 'duration': 0.22563197650015354, 'run_index': 0, 'setup': {'name': 'setup', 'duration': 0.0064605968073010445, 'outcome': 'passed'}, 'call': {'name': 'call', 'duration': 0.21237082267180085, 'outcome': 'passed'}, 'teardown': {'name': 'teardown', 'duration': 0.0003399602137506008, 'outcome': 'passed'}, 'outcome': 'passed'}, {'name': 'test/test_produkt.py::test_buffer_1b_voltage', 'duration': 0.06783118983730674, 'run_index': 1, 'setup': {'name': 'setup', 'duration': 0.0005186581984162331, 'outcome': 'passed'}, 'call': {'name': 'call', 'duration': 0.06649156985804439, 'outcome': 'passed'}, 'teardown': {'name': 'teardown', 'duration': 0.00030230358242988586, 'outcome': 'passed'}, 'outcome': 'passed'}, {'name': 'test/test_produkt.py::test_buffer_2a_voltage', 'duration': 0.06628352915868163, 'run_index': 2, 'setup': {'name': 'setup', 'duration': 0.00036448799073696136, 'outcome': 'passed'}, 'call': {'name': 'call', 'duration': 0.06524515384808183, 'outcome': 'passed'}, 'teardown': {'name': 'teardown', 'duration': 0.0003093993291258812, 'outcome': 'passed'}, 'outcome': 'passed'}, {'name': 'test/test_produkt.py::test_buffer_2b_voltage', 'duration': 0.06417899625375867, 'run_index': 3, 'setup': {'name': 'setup', 'duration': 0.0003621121868491173, 'outcome': 'passed'}, 'call': {'name': 'call', 'duration': 0.06313963187858462, 'outcome': 'passed'}, 'teardown': {'name': 'teardown', 'duration': 0.000315140001475811, 'outcome': 'passed'}, 'outcome': 'passed'}, {'name': 'test/test_produkt.py::test_output_amplifier_1_voltage', 'duration': 0.06402606330811977, 'run_index': 4, 'setup': {'name': 'setup', 'duration': 0.00033985963091254234, 'outcome': 'passed'}, 'call': {'name': 'call', 'duration': 0.06304994691163301, 'outcome': 'passed'}, 'teardown': {'name': 'teardown', 'duration': 0.0002963971346616745, 'outcome': 'passed'}, 'outcome': 'passed'}, {'name': 'test/test_produkt.py::test_output_amplifier_2_voltage', 'duration': 0.06275479821488261, 'run_index': 5, 'setup': {'name': 'setup', 'duration': 0.0004264460876584053, 'outcome': 'passed'}, 'call': {'name': 'call', 'duration': 0.06150294793769717, 'outcome': 'passed'}, 'teardown': {'name': 'teardown', 'duration': 0.00039895810186862946, 'outcome': 'passed'}, 'outcome': 'passed'}, {'name': 'test/test_produkt.py::test_trimpot_1_voltage', 'duration': 0.06260482640936971, 'run_index': 6, 'setup': {'name': 'setup', 'duration': 0.0004696645773947239, 'outcome': 'passed'}, 'call': {'name': 'call', 'duration': 0.06136759603396058, 'outcome': 'passed'}, 'teardown': {'name': 'teardown', 'duration': 0.0002979012206196785, 'outcome': 'passed'}, 'outcome': 'passed'}, {'name': 'test/test_produkt.py::test_trimpot_2_voltage', 'duration': 0.06243716413155198, 'run_index': 7, 'setup': {'name': 'setup', 'duration': 0.00034465081989765167, 'outcome': 'passed'}, 'call': {'name': 'call', 'duration': 0.061167610343545675, 'outcome': 'failed', 'longrepr': 'def test_trimpot_2_voltage():\n        simulator = load().simulator(temperature=25, nominal_temperature=25)\n        analysis_op = simulator.operating_point()\n        result = float(analysis_op["Net-_R8-Pad2_"])\n>       assert result == approx( -2.9941339771434902e-05, rel=1e-1 )\nE       assert -2.1085450543264016e-06 == -2.9941339771434902e-05 ± 3.0e-06\nE        +  where -2.9941339771434902e-05 ± 3.0e-06 = approx(-2.9941339771434902e-05, rel=0.1)\n\ntest/test_produkt.py:112: AssertionError'}, 'teardown': {'name': 'teardown', 'duration': 0.0005802521482110023, 'outcome': 'passed'}, 'outcome': 'failed'}], 'summary': {'passed': 7, 'failed': 1, 'num_tests': 8, 'duration': 1.4830241203308105}, 'created_at': '2021-11-14 13:49:53.775865'}}}}

import kicad
from kicad import parse_kibot
class TestParseFiles(unittest.TestCase):

    def test_schema(self):
        self.assertEqual( kicad.get_kicad_files('/foo/bar.pro')[0], '/foo/bar.sch')

    def test_pcb(self):
        self.assertEqual( kicad.get_kicad_files('/foo/bar.pro')[1], '/foo/bar.kicad_pcb')

    def test_name(self):
        self.assertEqual( kicad.get_kicad_name('/foo/bar.pro'), 'bar')

class TestParseKibot(unittest.TestCase):

    def test_erc_ok(self):
        result = {'erc': []}
        response = {}
        parse_kibot.kibot_parser('test/files/main-erc-ok.txt', response)
        self.assertEqual( response, result)
        
    def test_erc_error(self):
        result = {'erc': [{'code': '2', 'sheet': '/', 'message': 'Pin not connected (use a "no connection" flag to suppress this error)', 'con': [{'x': '227.33', 'y': '78.74', 'message': 'Pin 5 (Input) of component U5 is unconnected.'}]}, {'code': '2', 'sheet': '/', 'message': 'Pin not connected (use a "no connection" flag to suppress this error)', 'con': [{'x': '214.63', 'y': '123.19', 'message': 'Pin 3 (Input) of component U5 is unconnected.'}]}, {'code': '2', 'sheet': '/', 'message': 'Pin not connected (use a "no connection" flag to suppress this error)', 'con': [{'x': '214.63', 'y': '118.11', 'message': 'Pin 2 (Input) of component U5 is unconnected.'}]}, {'code': '2', 'sheet': '/', 'message': 'Pin not connected (use a "no connection" flag to suppress this error)', 'con': [{'x': '229.87', 'y': '120.65', 'message': 'Pin 1 (Output) of component U5 is unconnected.'}]}, {'code': '2', 'sheet': '/', 'message': 'Pin not connected (use a "no connection" flag to suppress this error)', 'con': [{'x': '233.68', 'y': '100.33', 'message': 'Pin 7 (Output) of component U6 is unconnected.'}]}, {'code': '2', 'sheet': '/', 'message': 'Pin not connected (use a "no connection" flag to suppress this error)', 'con': [{'x': '248.92', 'y': '102.87', 'message': 'Pin 6 (Input) of component U6 is unconnected.'}]}, {'code': '2', 'sheet': '/', 'message': 'Pin not connected (use a "no connection" flag to suppress this error)', 'con': [{'x': '248.92', 'y': '97.79', 'message': 'Pin 5 (Input) of component U6 is unconnected.'}]}, {'code': '2', 'sheet': '/', 'message': 'Pin not connected (use a "no connection" flag to suppress this error)', 'con': [{'x': '242.57', 'y': '76.20', 'message': 'Pin 7 (Output) of component U5 is unconnected.'}]}, {'code': '2', 'sheet': '/', 'message': 'Pin not connected (use a "no connection" flag to suppress this error)', 'con': [{'x': '227.33', 'y': '73.66', 'message': 'Pin 6 (Input) of component U5 is unconnected.'}]}, {'code': '2', 'sheet': '/', 'message': 'Pin not connected (use a "no connection" flag to suppress this error)', 'con': [{'x': '205.74', 'y': '76.20', 'message': 'Pin 7 (Output) of component U4 is unconnected.'}]}, {'code': '2', 'sheet': '/', 'message': 'Pin not connected (use a "no connection" flag to suppress this error)', 'con': [{'x': '190.50', 'y': '73.66', 'message': 'Pin 6 (Input) of component U4 is unconnected.'}]}, {'code': '2', 'sheet': '/', 'message': 'Pin not connected (use a "no connection" flag to suppress this error)', 'con': [{'x': '190.50', 'y': '78.74', 'message': 'Pin 5 (Input) of component U4 is unconnected.'}]}, {'code': '2', 'sheet': '/', 'message': 'Pin not connected (use a "no connection" flag to suppress this error)', 'con': [{'x': '33.02', 'y': '29.21', 'message': 'Pin TN (Passive) of component J2 is unconnected.'}]}, {'code': '2', 'sheet': '/', 'message': 'Pin not connected (use a "no connection" flag to suppress this error)', 'con': [{'x': '33.02', 'y': '24.13', 'message': 'Pin S (Passive) of component J2 is unconnected.'}]}]}
        response = {}
        parse_kibot.kibot_parser('test/files/main-erc-error.txt', response)
        self.assertEqual( response, result)

    def test_drc_ok(self):
        result = {'drc': [], 'unconnected': []}
        response = {}
        parse_kibot.kibot_parser('test/files/main-drc-ok.txt', response)
        self.assertEqual( response, result)

    def test_drc_unconnected(self):
        result = {'drc': [], 'unconnected': [{'code': '2', 'sheet': '/', 'message': 'Unconnected items', 'con': [{'x': '61.722', 'y': '94.148', 'message': 'Pad 6 of J1 on All copper layers'}, {'x': '59.182', 'y': '94.148', 'message': 'Pad 5 of J1 on All copper layers'}]}, {'code': '2', 'sheet': '/', 'message': 'Unconnected items', 'con': [{'x': '59.182', 'y': '96.688', 'message': 'Pad 7 of J1 on All copper layers'}, {'x': '59.182', 'y': '94.148', 'message': 'Pad 5 of J1 on All copper layers'}]}, {'code': '2', 'sheet': '/', 'message': 'Unconnected items', 'con': [{'x': '61.722', 'y': '96.688', 'message': 'Pad 8 of J1 on All copper layers'}, {'x': '59.182', 'y': '96.688', 'message': 'Pad 7 of J1 on All copper layers'}]}, {'code': '2', 'sheet': '/', 'message': 'Unconnected items', 'con': [{'x': '61.722', 'y': '96.688', 'message': 'Pad 8 of J1 on All copper layers'}, {'x': '68.732', 'y': '98.518', 'message': 'Pad 1 of C2 on All copper layers'}]}, {'code': '2', 'sheet': '/', 'message': 'Unconnected items', 'con': [{'x': '84.542', 'y': '86.868', 'message': 'Pad 2 of C1 on All copper layers'}, {'x': '68.732', 'y': '98.518', 'message': 'Pad 1 of C2 on All copper layers'}]}, {'code': '2', 'sheet': '/', 'message': 'Unconnected items', 'con': [{'x': '82.042', 'y': '86.868', 'message': 'Pad 1 of C1 on All copper layers'}, {'x': '67.497', 'y': '84.968', 'message': 'Pad 1 of R1 on All copper layers'}]}, {'code': '2', 'sheet': '/', 'message': 'Unconnected items', 'con': [{'x': '71.232', 'y': '98.518', 'message': 'Pad 2 of C2 on All copper layers'}, {'x': '67.497', 'y': '89.018', 'message': 'Pad 1 of R2 on All copper layers'}]}, {'code': '2', 'sheet': '/', 'message': 'Unconnected items', 'con': [{'x': '59.182', 'y': '99.228', 'message': 'Pad 9 of J1 on All copper layers'}, {'x': '61.722', 'y': '99.228', 'message': 'Pad 10 of J1 on All copper layers'}]}, {'code': '2', 'sheet': '/', 'message': 'Unconnected items', 'con': [{'x': '61.722', 'y': '91.608', 'message': 'Pad 4 of J1 on All copper layers'}, {'x': '59.182', 'y': '91.608', 'message': 'Pad 3 of J1 on All copper layers'}]}, {'code': '2', 'sheet': '/', 'message': 'Unconnected items', 'con': [{'x': '77.657', 'y': '84.968', 'message': 'Pad 2 of R1 on All copper layers'}, {'x': '61.722', 'y': '91.608', 'message': 'Pad 4 of J1 on All copper layers'}]}, {'code': '2', 'sheet': '/', 'message': 'Unconnected items', 'con': [{'x': '61.722', 'y': '89.068', 'message': 'Pad 2 of J1 on All copper layers'}, {'x': '59.182', 'y': '89.068', 'message': 'Pad 1 of J1 on All copper layers'}]}, {'code': '2', 'sheet': '/', 'message': 'Unconnected items', 'con': [{'x': '77.657', 'y': '89.018', 'message': 'Pad 2 of R2 on All copper layers'}, {'x': '61.722', 'y': '89.068', 'message': 'Pad 2 of J1 on All copper layers'}]}]}
        response = {}
        parse_kibot.kibot_parser('test/files/main-drc-unconnected.txt', response)
        self.assertEqual( response, result)

class TestCombineResults(unittest.TestCase):

    def test_combined_reports(self):
        self.assertEqual( parse_kibot.combine_reports(['test/files/kontur_main_bom.json', 'test/files/kontur_main_report.json']), comnbined_result)

class TestCombineResultsWithTests(unittest.TestCase):

    def test_combined_reports(self):
        self.assertEqual( parse_kibot.combine_reports(['test/files/kontur_main_bom.json', 'test/files/kontur_main_report.json', 'test/files/produkt_test.json']), comnbined_result_test)
